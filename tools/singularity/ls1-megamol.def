bootstrap: localimage
from: base.sif

%post
    dnf -y install mpich mpich-devel
    dnf -y install cmake git
    mkdir -p /tmp
    cd /tmp
    git clone https://github.com/ls1mardyn/ls1-mardyn.git --depth 1
    source scl_source enable gcc-toolset-10
    export CFLAGS=-I/usr/include/mpich-x86_64
    export CXXFLAGS=-I/usr/include/mpich-x86_64
    cd ls1-mardyn
    cmake -B build -D ENABLE_MPI=ON -D CMAKE_INSTALL_PREFIX=/opt/ls1 -D CMAKE_C_COMPILER=/usr/lib64/mpich/bin/mpicc -D CMAKE_CXX_COMPILER=/usr/lib64/mpich/bin/mpic++
    cmake --build build -- -j
    # this would work but does nothing currently
    cmake --install build