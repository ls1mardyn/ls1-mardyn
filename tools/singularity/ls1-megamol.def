bootstrap: localimage
from: base.sif

%files
    ../../../ls1-mardyn/cmake /tmp/ls1-mardyn/cmake
    ../../../ls1-mardyn/src /tmp/ls1-mardyn/src
    ../../../ls1-mardyn/CMakeLists.txt /tmp/ls1-mardyn/CMakeLists.txt

%post
    dnf -y install mpich mpich-devel
    dnf -y install cmake git
    source scl_source enable gcc-toolset-10
    export CFLAGS=-I/usr/include/mpich-x86_64
    export CXXFLAGS=-I/usr/include/mpich-x86_64
    cd /tmp/ls1-mardyn
    cmake -B build -D ENABLE_MPI=ON -D CMAKE_INSTALL_PREFIX=/opt/ls1 -D CMAKE_C_COMPILER=/usr/lib64/mpich/bin/mpicc -D CMAKE_CXX_COMPILER=/usr/lib64/mpich/bin/mpic++
    cmake --build build -- -j
    # this would work but does nothing currently
    cmake --install build