<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ls1-MarDyn: General Plugins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ls1-MarDyn
   </div>
   <div id="projectbrief">ls1-MarDyn molecular dynamics code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">General Plugins </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Basic Idea </h2>
<p >The idea of the General Plugins is to allow <em>optional</em> code, which is not necessarily needed by all simulations to be inserted at specific locations in the primary simulation loop. This is to be used for various outputs, modifications to some molecules, etc. You can (and are recommended to) achieve all modifications to the primary program through such plugins. Some advantages of doing so. Plugins:</p><ul>
<li>provide a non-intrusive way of interacting with the main program,</li>
<li>are easy to switch on and off via XML,</li>
<li>are easy to maintain,</li>
<li>are easy to exchange with other users,</li>
<li>do not pollute other classes, which are necessary for running the main code, such as <a class="el" href="classSimulation.html" title="Controls the simulation process.">Simulation</a> and <a class="el" href="classDomain.html" title="This class is used to read in the phasespace and to handle macroscopic values.">Domain</a>.</li>
</ul>
<p >(Note to older developers - this is an extension of the familiar concept of output plugins, present for a long time in ls1-mardyn.)</p>
<p >The schematic below shows the possible places in the program, at which you can insert your code. </p><div class="image">
<img src="general-plugins.png" alt=""/>
</div>
<h2>Comments about the state of the simulation at the individual interface calls </h2>
<p ><a class="el" href="classPluginBase.html#a69bdae0b01153fabd0785c0f7d1f2c2f" title="Method will be called first thing in a new timestep.">PluginBase::beforeEventNewTimestep</a>: The iteration has just began. Molecules are sorted in the correct cells. Position and velocity are available at the exact same physical time. Timestep counter has been advanced already, but not position or velocity, so look out for mismatches. Consider using <a class="el" href="classPluginBase.html#aad4e7f87aaafbb4128984db87ea7a01f" title="Method endStep will be called at the end of each time step.">PluginBase::endStep</a>.</p>
<p ><a class="el" href="classPluginBase.html#aec6f3065650556bd93e35570e7969057" title="Method beforeForces will be called before forcefields have been applied no alterations w....">PluginBase::beforeForces</a>: The positions have been updated by a full timestep, while the velocities by a half timestep (see information on the <a class="el" href="classLeapfrog.html" title="Implementation of the rotational leapfrog integration scheme.">Leapfrog</a> integration scheme). (Some of) the molecules are not sorted in the correct cells. This step is appropriate for small modifications to the positions of molecules. However, moving a molecule by a large distance (on the order of a cutoff-radius) may lead to undefined behaviour.</p>
<p ><a class="el" href="classPluginBase.html#a5aa1f058f322b9822eed3cdecd6aae74" title="Method siteWiseForces will be called before forcefields have been applied alterations to sitewise for...">PluginBase::siteWiseForces</a>: Molecules are sorted correctly and most individual forces are available, but not yet updated for the entire molecule. Add additional forces to molecules and/or sitewise forces here. <b>Sitewise</b> force addition via Fljcenteradd() will <b>only work here. Fadd() will also work in afterForces().</b>.</p>
<p ><a class="el" href="classPluginBase.html#ad358acf7c5b5b895df21562c70a34a2f" title="Method afterForces will be called after forcefields have been applied no sitewise Forces can be appli...">PluginBase::afterForces</a>: The new forces are available. There are molecules in the Halo cells (@Steffen maybe comment on the non-Full-shell MPI schemes?). Information on the individual molecular sites is up to date. This step is appropriate to compute any additional force contributions.</p>
<p ><a class="el" href="classPluginBase.html#aad4e7f87aaafbb4128984db87ea7a01f" title="Method endStep will be called at the end of each time step.">PluginBase::endStep</a>: Virtually the same state as beforeEventNewTimestep, but the timestep counter is also good. This step is appropriate for output.</p>
<p >Important: if you need arguments to one of the interface calls, which are not already present, do not add them directly. Get them through the global_simulation object instead! Also, think about whether those arguments should maybe be member fields of your plugin.</p>
<h2>Writing a new Plugin </h2>
<p >When writing a new plugin, you please do the following:</p><ol type="1">
<li>check the table of already existing plugins, to see whether some existin plugin already does what you need it to do, or can be meaningfully generalized to do what you need it to do (e.g. an existing plugin is collecting output along the X-dimension, and you need it to collect output along the Y-dimension, then it might be more meaningful to generalize the existing plugin, then to write a completely new one).</li>
<li>implement a new class by deriving from <a class="el" href="classPluginBase.html" title="The PluginBase class provides the interface for any kind of output/plugin classes - called &quot;(output) ...">PluginBase</a> (lets call it NewPlugin)</li>
<li>write your code and place it in src/plugins/NewPlugin.h and src/plugins/NewPlugin.cpp (keep in mind the styleguide rules!)</li>
<li>add your code to the <a class="el" href="classPluginFactory.html" title="Plugin Factory.">PluginFactory</a> by adding the lines<ul>
<li>#include "plugins/NewPlugin.h"</li>
<li>REGISTER_PLUGIN(NewPlugin);</li>
</ul>
</li>
<li>document your plugin in the summary <a class="el" href="PluginsSummary.html">Plugin Summary</a>, so that other users know that it is there and would not reimplement it</li>
<li>write a UnitTest for it, so that other people changing base code or - potentially generalizing/optimizing/bugfixing your plugin - will know whether they have broken it.</li>
<li>write some doxygen documentation.</li>
</ol>
<h2>Background </h2>
<p >The reason for introducing and insisting on using Plugins is because the classes <a class="el" href="classSimulation.html" title="Controls the simulation process.">Simulation</a> and <a class="el" href="classDomain.html" title="This class is used to read in the phasespace and to handle macroscopic values.">Domain</a> become (became) very cluttered with application-specific code. This makes it very difficult to maintain the code and determine which features are on, which features are off. We have had grave errors due to this, e.g. have a supercomputer reserved for us an entire day only to have all our simulations crash when running on &gt;10000 MPI, because of uninitialized values in user code, which was not supposed to be active at all. So, please, stick to the rules and work with Plugins as much as possible. If you cannot achieve something with a plugin (i.e. the Plugin Interface needs to be extended), contact us so that we can extend them.</p>
<p >For a summary of Plugins currently in the trunk, see <a class="el" href="PluginsSummary.html">Plugin Summary</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 9 2023 10:05:32 for ls1-MarDyn by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
